---
layout: post
title: "SSH inside SSL"
tags: [ssh, ssl, haproxy]
---
{% include JB/setup %}

ssh over https connection using haproxy.

    ~$ cat ~/.ssh/config
    Host tun-example
    Hostname ssh.example.net
    Port 443
    User example
    ProxyCommand=openssl s_client -host %h -port %p -servername %h

    ~$ cat /etc/haproxy/haproxy.cfg
    frontend public
        mode tcp

        bind :80
        redirect scheme https code 301 if !{ ssl_fc }

        bind :443 ssl crt example.pem no-tls-tickets

        tcp-request inspect-delay 5s
        tcp-request content accept if HTTP

        # ....
        use_backend ssh if { ssl_fc_sni ssh.example.com }


     backend ssh
        mode tcp
        server ssh 127.0.0.1:22 send-proxy
        timeout server 2h
